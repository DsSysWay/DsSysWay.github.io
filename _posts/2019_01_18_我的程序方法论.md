---
layout: page
title: "我的程序方法论"
categories:
- 方法论
tags:
- 方法论
---



程序开发要沉淀自己的方法论。说到方法论大家会觉得比较虚。
是一个抽象的东西。我认为的方法论是做开发，做业务过程中
采用的能够提高效率，减少出问题概率的一些做事方式和思维习惯。

下面整理下我自己工作几年来在各个工作场景下觉得有用的一些方法。

####需求分析####

刚毕业的时候，拿到产品需求就开始吭哧吭哧的做方案设计，这是新人通常容易犯的错。有时候产品经理所做的需求方案设计并没有考虑充分。 我接触到的有些产品是直接拿着竞品的特性对着抄的，而且大多数时候是只考虑了正常情况，异常情况并没有考虑进去。又或者本身就不太适合做到现有系统里。导致做完实现后产品可能又说这个需求不做了。网上有很多段子说程序员与产品的有些矛盾就是这么来的。但本身这个事情开发这边也有错。拿到需求后，我们可以遵循如下方法先走一轮：

-	what【这个需求是什么，在什么场景下使用，谁来用】
-	why 【为什么要做这个需求？能给用户带来什么价值?】
-	how 【怎么做，是否可以不做，是否可以换其他方式来达到同样的目的？异常情况有哪些，针对异常情况如何处理？有哪些潜在的体验问题或者性能问题？】
-	when 【这个需求完成时间结点是什么时候？跟哪个版本？什么时候转测？是否是重点特性？】

跟产品经理谈what和why以及how。可以帮助他理清楚需求的细节，把异常情况都考虑进去。 在这个阶段可以把不靠谱的需求pk掉或者修改掉。但是这种方式不太适用于老板的需求。如果对方以这是boss的需求为由，除非很不靠谱，要不就只能埋头做了。
谈when 可以帮助你理清楚需求的优先级和重要程度，进而重新调整自己工作任务的优先级。

####方案设计，接口设计，协议设计####

-	 借助图示剖析系统。
人脑能够记住的东西有限，拿到系统之后。把脉络梳理出来。
可以借助processon在线作图工具，把系统的状态流转图，以及
流程图 画出来。 在这些流程过程中需要传递什么数据，需要缓存
和持久化什么数据自然就出来了。然后再设计内存数据模型以及持久化
数据模型。这里还推荐另外一个UML建模工具astah

关于状态流转的图一定要画。我以前设计过一个社交结拜系统，结拜队伍的数据结构就是因为没有画状态图。 在结拜队伍解散的时候没有及时去删除内存数据，缺失了最后一个状态的管理，结果使得内存脏数据又做了持久化，导致部分玩家解散了结拜队伍又重新回档的问题。这些问题如果一开始就用状态流转考虑进去，就不会出现线上的事故问题。 在上线阶段处理这些问题的成本要比在设计阶段大很多。可能少考虑了一点，换来的是一个通宵处理事故，甚至是部门业务的损失。



-	方案设计先走常规流程，再覆盖异常情况。

跟人讲设计方案的时候，只讲正常处理流程。这样子方便讲清楚梗概。
然后再讲异常情况，边界情况处理。	作为方案的后续补充。


-	做方案设计永远要准备B方案。陈述利弊，调研清楚类似产品的方案实现有缺点。要有推导过程。
没有推导过程的方案难以服众。自己也容易吊到自我yy的坑里。

-	编程要提炼抽象和重构能力。

抽象是使得接口简洁，隐藏实现细节，构造可维护可复用代码的一个好的方式。适时的抽象可以减少很多重复无用的工作。抽象不止说的是接口，在协议设计中也要提前考虑进去。 使用union来隐藏个性化数据。 抽取公共字段。减少需求变更带来的协议变更成本

-	协议设计， 数据模型设计考虑扩展场景

	-	如果一个接口未来有可能会设计成批量，那么在一开始设计的时候就直接设计成批量接口。
	-	如果一个结构未来可能扩展其他特性。那么设计结构的时候就应该设计成一个类结构包裹起来。 




####日常工作####

-	善用自动化提高效率
	-	每天下班前硬性挤出一点时间反思下今天工作中有哪些是机械重复的工作。 有那么就考虑写个脚本或者接入某些定时任务把这些机械工作托管给机器来做，机器做重复任务永远比人靠谱。让自己和团队的精力放在更重要的工作上。
	<br>例如：
		-	我们以前每周都有值班人，需要每天发布版本到沙箱环境去。这个事情可以交给devops来做。我们只需要在部署出错的时候看看即可。
		-	如果编译部署测试环境需要敲多个指令，那么就考虑写个脚本一键执行。
		-	线上出问题每次需要vpn断点上去看，那么考虑写个自动化脚本自动获取线上最新的coredump堆栈，拉取最新的错误日志，拉取机器的上下文信息，附带监控系统信息一并通过微信告警出来，提高定位问题的效率。


	


####系统压测和优化####

-	系统压测需要先量化，然后才能展开针对性的优化。
例如微博压测feed的时候，只要有1%的用户落在了1s以上的区间，就认为无法满足体验要求了，例如亚马逊接口失败率要控制在99.99% 有了这些量化指标，你才能够知道压测到什么程度。
我做web系统的时候，对于web的压测采用的指标是平均请求延时不超过500ms。至于这个怎么得出来的，需要你和产品去讨论，和用户体验的人去讨论得出一个目标来。压到延时500ms就可以停了，这个时候就是系统的处理上限。 继续往上压qps和tps还能上去，但是这个时候已经有大量超时了，这种压测数据也就没有意义了。


####切入新项目####

-	每个人进入团队都要面临重新进入一个新的项目。那么怎么快速上手一个新的项目。这里也有一套做事的方法。
按照步骤，可以按照以下方式来熟悉项目。
	-	了解项目使用的技术栈和技术组件。例如编程使用什么开发语言，数据使用什么格式来表示。前端接入，负载均衡，业务处理，数据持久化采用什么组件。采用的是同步、异步、还是协程的编程模型。这个阶段只需要了解个大概即可。
	-	了解业务封装的逻辑开发框架
	-	了解系统整体架构设计，进程分布，主体模块组成，以及网络拓扑结构，部署方式
	-	跟导师了解下自己写个echo接口。在测试环境请求模拟走完整个链路
完成上述步骤基本可以开始做需求了，后续组件的坑还是需要自己慢慢去使用和体会。切入新项目最好的方式还是尽快动手做东西。



####系统架构设计####

- 架构设计的目的是为了降低软件复杂度，减少维护和扩展的成本。
架构设计需要根据业务特性，有选择性的在【高并发，高可用，扩展性，安全性， 可维护性】 几个特性之中做出选择，同时
要兼顾开发进度和部门团队的实际人力情况，支撑部门的支撑力度。

做架构设计的时候可以按照如下套路来：
-	根据业务出发评估系统指标，评估读写模型【读多写少? 读少写多】 追去强一致性？ 追求安全性？ 数据存储量多大。
-	根据业务目标团队技术栈和支持部门提供的组件支持考虑实现的技术栈和接入的组件。这里的业务目标很重要，估算错了设计出来的方案差异也大。以前我所在的战略项目就是因为估算太夸张，浪费了不少人力在一套过度设计的架构上，导致大家的开发效率反而上不去。
-	最后下列因素是作为一个线上系统需要考虑进去的。
	-	分布式自动化发布和部署。灰度策略
	-	监控，这个监控包括系统监控，总体流量监控，业务接口监控等
	-	热重启
	-	容灾方案考虑
	-  安全性，这个安全包括代码层级的安全【栈溢出保护，sql注入，堆溢出保护】， 系统层级【dos攻击】 组件漏洞。以及内部服务的网络隔离。
	-  系统瓶颈评估。
	-  服务容量监控与扩容	
暂时就这些，想到了再补充
